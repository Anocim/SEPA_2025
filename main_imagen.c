#include <stdint.h>
#include <stdbool.h>
#include <stdlib.h>
#include "driverlib2.h"
#include "utils/uartstdio.h"
#include "FT800_TIVA.h"
#include <stdio.h>
#include <string.h>

//*****************************************************************************
//
// System clock rate in Hz.
//
//*****************************************************************************
uint32_t RELOJ;


//#define SLEEP SysCtlSleep()
#define SLEEP SysCtlSleepFake()
#define RGB565               7
#define BITMAPS              1
#define BITMAP_SOURCE(addr) ((1<<24)|(((addr)&1048575)<<0))
#define BITMAP_LAYOUT(format,linestride,height) ((7<<24)|(((format)&31)<<19)|(((linestride)&1023)<<9)|(((height)&511)<<0))
#define BITMAP_SIZE(filter,wrapx,wrapy,width,height) ((8<<24)|(((filter)&1)<<20)|(((wrapx)&1)<<19)|(((wrapy)&1)<<18)|(((width)&511)<<9)|(((height)&511)<<0))

#define BEGIN(prim) ((31<<24)|(((prim)&15)<<0))
#define END() ((33<<24))
uint32_t destino =RAM_G + 16;
uint32_t adress=RAM_G, width_dir=RAM_G+4, height_dir=RAM_G+8, ptr, ancho, alto;
unsigned int CMD_Offset_G = 0;

const uint8_t laberinto_bueno[] = {
  0xa2, 0x10, 0x81, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0x61, 0x08, 0x61, 0x08, 0xa2, 0x10, 0xa2, 0x08, 0x81, 0x08, 0xa2, 0x08, 0x81, 0x08, 0xc2, 0x10, 0xa2, 0x08, 0xc2, 0x08, 0xc2, 0x08, 0xa2, 0x08, 0xc2, 0x08, 0x61, 0x00, 0xe2, 0x10, 0xa1, 0x08, 0x81, 0x08, 0xa2, 0x08, 0x81, 0x08, 0xa1, 0x08, 0xa1, 0x08, 0xa1, 0x08, 0xa1, 0x08, 0x61, 0x08, 0xe3, 0x10, 0x81, 0x08, 0x81, 0x08, 0xa2, 0x10,
  0x81, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0x61, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xc2, 0x10, 0x81, 0x08, 0xa2, 0x08, 0xc2, 0x10, 0xa2, 0x08, 0xa2, 0x08, 0x81, 0x08, 0x81, 0x08, 0xc2, 0x10, 0xa2, 0x08, 0xa2, 0x08, 0xc2, 0x10, 0x81, 0x08, 0x81, 0x08, 0xc2, 0x10, 0x81, 0x08, 0xa1, 0x08, 0xa2, 0x08, 0x81, 0x08, 0xa1, 0x08, 0xa1, 0x08, 0xc2, 0x10, 0x81, 0x08, 0x81, 0x08, 0xa2, 0x10, 0x81, 0x08,
  0xa2, 0x10, 0x61, 0x08, 0xe3, 0x18, 0x69, 0x4a, 0x48, 0x4a, 0x28, 0x42, 0x48, 0x42, 0x49, 0x42, 0x49, 0x42, 0x48, 0x42, 0x28, 0x42, 0x69, 0x42, 0x69, 0x42, 0x48, 0x3a, 0x69, 0x42, 0x48, 0x42, 0x48, 0x42, 0x48, 0x42, 0x69, 0x42, 0x68, 0x42, 0x89, 0x4a, 0x48, 0x42, 0x27, 0x3a, 0x68, 0x42, 0x48, 0x42, 0x48, 0x42, 0x28, 0x42, 0x48, 0x42, 0x28, 0x42, 0x03, 0x19, 0x81, 0x10, 0x81, 0x08,
  0xa2, 0x10, 0x61, 0x08, 0x69, 0x4a, 0x9d, 0xf7, 0x99, 0xd6, 0xba, 0xd6, 0xba, 0xd6, 0x99, 0xce, 0xba, 0xd6, 0xba, 0xd6, 0xba, 0xd6, 0xba, 0xce, 0xba, 0xce, 0xda, 0xd6, 0xda, 0xd6, 0xba, 0xce, 0xba, 0xce, 0xba, 0xd6, 0xb9, 0xce, 0x99, 0xce, 0x1b, 0xdf, 0x7c, 0xe7, 0xba, 0xd6, 0x79, 0xce, 0xb9, 0xce, 0x99, 0xce, 0x99, 0xce, 0x99, 0xce, 0x9d, 0xef, 0x69, 0x4a, 0x40, 0x08, 0xc2, 0x10,
  0x81, 0x10, 0x82, 0x10, 0x48, 0x4a, 0xba, 0xd6, 0x85, 0x31, 0xc2, 0x18, 0xe3, 0x18, 0x03, 0x19, 0xe3, 0x18, 0x03, 0x19, 0xe3, 0x18, 0xe3, 0x18, 0xe3, 0x10, 0xe3, 0x18, 0xe3, 0x10, 0x03, 0x19, 0x03, 0x19, 0xc2, 0x10, 0x23, 0x19, 0xe3, 0x18, 0xce, 0x73, 0xf7, 0xbd, 0x24, 0x21, 0xc2, 0x18, 0xc2, 0x10, 0x03, 0x19, 0xe3, 0x18, 0x24, 0x21, 0xba, 0xd6, 0x89, 0x4a, 0xa2, 0x10, 0x81, 0x08,
  0x82, 0x10, 0xc2, 0x18, 0x28, 0x4a, 0x79, 0xce, 0xe3, 0x18, 0x07, 0x42, 0xae, 0x73, 0xae, 0x73, 0xae, 0x73, 0xae, 0x73, 0x6d, 0x6b, 0x24, 0x21, 0x85, 0x29, 0xce, 0x73, 0xae, 0x73, 0xae, 0x73, 0xae, 0x73, 0xef, 0x7b, 0x4c, 0x63, 0xc2, 0x10, 0x8d, 0x6b, 0xb6, 0xb5, 0x61, 0x08, 0xca, 0x52, 0xae, 0x73, 0xae, 0x73, 0x07, 0x42, 0xc3, 0x18, 0xba, 0xd6, 0x49, 0x4a, 0x81, 0x10, 0xc2, 0x18,
  0x81, 0x10, 0x82, 0x10, 0x28, 0x42, 0x79, 0xd6, 0x24, 0x21, 0x30, 0x84, 0xda, 0xde, 0x75, 0xad, 0x34, 0xa5, 0xb6, 0xb5, 0x3c, 0xe7, 0xa6, 0x31, 0xaa, 0x52, 0x7d, 0xef, 0x96, 0xb5, 0x34, 0xa5, 0x95, 0xad, 0x75, 0xad, 0xda, 0xd6, 0x44, 0x21, 0x4c, 0x63, 0xb6, 0xb5, 0xe3, 0x18, 0x0f, 0x84, 0x54, 0xad, 0xda, 0xde, 0x71, 0x8c, 0x24, 0x21, 0x79, 0xce, 0x69, 0x4a, 0x82, 0x10, 0x81, 0x10,
  0x82, 0x10, 0xa2, 0x10, 0x48, 0x4a, 0xba, 0xde, 0xa2, 0x10, 0x10, 0x84, 0x34, 0xa5, 0x82, 0x10, 0xa2, 0x10, 0x45, 0x29, 0x1c, 0xe7, 0xa6, 0x31, 0xaa, 0x52, 0x79, 0xce, 0xe3, 0x18, 0xc2, 0x10, 0xa2, 0x10, 0x85, 0x31, 0xfb, 0xde, 0x24, 0x21, 0x6d, 0x6b, 0xb6, 0xb5, 0xa2, 0x10, 0x81, 0x10, 0xa2, 0x10, 0xf3, 0x9c, 0x30, 0x84, 0xe3, 0x18, 0x99, 0xd6, 0x89, 0x52, 0x82, 0x10, 0x82, 0x10,
  0xa2, 0x18, 0x61, 0x10, 0x69, 0x4a, 0x79, 0xd6, 0xc3, 0x18, 0x10, 0x84, 0xba, 0xd6, 0x51, 0x8c, 0xa6, 0x31, 0x65, 0x29, 0x5c, 0xe7, 0xb2, 0x94, 0x34, 0xa5, 0x79, 0xce, 0x03, 0x19, 0xaa, 0x52, 0xca, 0x52, 0xa6, 0x31, 0xfb, 0xde, 0x24, 0x21, 0x6d, 0x6b, 0xda, 0xde, 0x91, 0x94, 0x6d, 0x6b, 0xa2, 0x10, 0xd3, 0x9c, 0x30, 0x8c, 0xe3, 0x18, 0x99, 0xd6, 0x69, 0x4a, 0xa2, 0x18, 0x81, 0x10,
  0x82, 0x10, 0x82, 0x10, 0x49, 0x4a, 0x9a, 0xd6, 0x04, 0x21, 0xaa, 0x5a, 0xd3, 0x9c, 0x13, 0xa5, 0xe7, 0x39, 0x44, 0x29, 0x9d, 0xf7, 0x54, 0xad, 0xd3, 0x9c, 0x30, 0x84, 0xc2, 0x18, 0xb2, 0x94, 0xb2, 0x94, 0x24, 0x21, 0x91, 0x8c, 0xc2, 0x10, 0x28, 0x42, 0xf3, 0x9c, 0xf3, 0x9c, 0xef, 0x7b, 0x61, 0x08, 0x13, 0xa5, 0x50, 0x8c, 0x03, 0x21, 0x79, 0xd6, 0x69, 0x4a, 0x61, 0x10, 0x81, 0x10,
  0x82, 0x10, 0xa2, 0x10, 0x49, 0x4a, 0x9a, 0xd6, 0xc3, 0x18, 0x82, 0x10, 0x82, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0x65, 0x29, 0xfb, 0xde, 0x86, 0x31, 0xc2, 0x18, 0x81, 0x10, 0xc2, 0x18, 0xb2, 0x94, 0xf3, 0x9c, 0x61, 0x08, 0xe3, 0x18, 0xc2, 0x10, 0x03, 0x19, 0xc2, 0x18, 0xa2, 0x10, 0xa2, 0x10, 0xc3, 0x18, 0xf3, 0x9c, 0x30, 0x8c, 0xe3, 0x18, 0x9a, 0xd6, 0x69, 0x4a, 0x81, 0x10, 0xa2, 0x18,
  0x61, 0x10, 0x82, 0x10, 0x49, 0x4a, 0x79, 0xd6, 0xe3, 0x20, 0x2c, 0x6b, 0xb6, 0xbd, 0xd7, 0xbd, 0xd6, 0xbd, 0xf7, 0xbd, 0x5c, 0xe7, 0xc6, 0x31, 0x28, 0x42, 0xd6, 0xbd, 0xf7, 0xbd, 0xfb, 0xde, 0x34, 0xa5, 0x85, 0x31, 0xd6, 0xbd, 0xf7, 0xbd, 0xf7, 0xbd, 0xd6, 0xbd, 0xf7, 0xbd, 0xf7, 0xbd, 0xf7, 0xbd, 0x3c, 0xe7, 0x50, 0x8c, 0x03, 0x21, 0x79, 0xd6, 0x89, 0x52, 0x61, 0x08, 0x81, 0x10,
  0xa2, 0x10, 0x82, 0x10, 0x28, 0x4a, 0x9a, 0xd6, 0xc3, 0x18, 0x10, 0x84, 0x58, 0xce, 0x6d, 0x6b, 0x4d, 0x6b, 0x8d, 0x73, 0x6d, 0x6b, 0xe3, 0x18, 0xaa, 0x52, 0x1b, 0xe7, 0xae, 0x73, 0x6d, 0x6b, 0x48, 0x42, 0xa6, 0x31, 0x5c, 0xef, 0xef, 0x7b, 0x8d, 0x6b, 0x8d, 0x6b, 0x8d, 0x6b, 0x6d, 0x6b, 0x6d, 0x6b, 0x6d, 0x6b, 0x28, 0x42, 0xc3, 0x18, 0x79, 0xce, 0x48, 0x4a, 0xc2, 0x18, 0x81, 0x10,
  0x82, 0x10, 0x82, 0x10, 0x49, 0x4a, 0xba, 0xde, 0xe3, 0x18, 0xef, 0x7b, 0x14, 0xa5, 0xa2, 0x10, 0xe3, 0x18, 0xc2, 0x10, 0x03, 0x19, 0xe3, 0x18, 0x2c, 0x63, 0x79, 0xce, 0xe3, 0x18, 0xe3, 0x18, 0xc2, 0x10, 0xa6, 0x31, 0xda, 0xd6, 0x44, 0x29, 0xc2, 0x10, 0xe3, 0x18, 0xe3, 0x18, 0x03, 0x19, 0x03, 0x21, 0x03, 0x19, 0x03, 0x19, 0x85, 0x29, 0xda, 0xde, 0x69, 0x4a, 0xa2, 0x10, 0x81, 0x10,
  0x82, 0x10, 0xa2, 0x10, 0x28, 0x4a, 0x9a, 0xd6, 0xe3, 0x18, 0x10, 0x84, 0x13, 0xa5, 0xa2, 0x10, 0x75, 0xad, 0x5c, 0xe7, 0x1b, 0xe7, 0x3c, 0xe7, 0x5c, 0xe7, 0xb9, 0xce, 0xe3, 0x18, 0x0f, 0x7c, 0xb2, 0x94, 0x85, 0x29, 0x5c, 0xe7, 0x44, 0x21, 0x2c, 0x63, 0x3c, 0xe7, 0x7d, 0xef, 0x3c, 0xe7, 0x5c, 0xe7, 0x3c, 0xe7, 0x5c, 0xe7, 0x3c, 0xe7, 0x7d, 0xef, 0x69, 0x4a, 0x81, 0x10, 0xa2, 0x10,
  0x82, 0x10, 0x82, 0x10, 0x49, 0x4a, 0x99, 0xd6, 0xe3, 0x18, 0x51, 0x8c, 0xf3, 0x9c, 0xa2, 0x10, 0x65, 0x29, 0xe7, 0x39, 0xc6, 0x31, 0xc6, 0x39, 0xe7, 0x39, 0x85, 0x29, 0xc2, 0x10, 0x91, 0x8c, 0xf3, 0x9c, 0xc6, 0x31, 0xfb, 0xde, 0x24, 0x21, 0x6d, 0x6b, 0xf7, 0xbd, 0x24, 0x21, 0x86, 0x31, 0x65, 0x29, 0x85, 0x29, 0x65, 0x29, 0xc6, 0x31, 0xdb, 0xde, 0x69, 0x4a, 0x61, 0x08, 0xa2, 0x10,
  0xa2, 0x08, 0xa2, 0x10, 0x48, 0x42, 0x99, 0xce, 0x03, 0x19, 0xef, 0x7b, 0xb6, 0xb5, 0xc6, 0x39, 0xe7, 0x39, 0xc6, 0x39, 0xe7, 0x39, 0xe7, 0x39, 0xc6, 0x31, 0xa6, 0x31, 0xa2, 0x10, 0x91, 0x8c, 0xf3, 0x9c, 0x85, 0x29, 0x3c, 0xe7, 0x44, 0x21, 0x4c, 0x63, 0xf7, 0xbd, 0xe7, 0x39, 0xc6, 0x31, 0xc7, 0x39, 0xa6, 0x31, 0x24, 0x21, 0x24, 0x21, 0x9a, 0xd6, 0x69, 0x4a, 0x82, 0x10, 0xa2, 0x10,
  0xa1, 0x08, 0xa2, 0x08, 0x48, 0x42, 0x79, 0xce, 0x03, 0x19, 0xce, 0x73, 0x3c, 0xe7, 0x5c, 0xef, 0x3c, 0xe7, 0x1c, 0xe7, 0x5d, 0xef, 0x1c, 0xe7, 0x7d, 0xef, 0x79, 0xce, 0x03, 0x19, 0x71, 0x8c, 0x13, 0xa5, 0xa6, 0x31, 0x58, 0xce, 0x44, 0x29, 0x4c, 0x63, 0x5c, 0xe7, 0x3c, 0xe7, 0x3c, 0xe7, 0x3c, 0xe7, 0x9d, 0xef, 0x51, 0x8c, 0x04, 0x21, 0x79, 0xce, 0x69, 0x52, 0x82, 0x10, 0x41, 0x08,
  0xc2, 0x10, 0x81, 0x08, 0x48, 0x42, 0xba, 0xce, 0xc2, 0x10, 0xc2, 0x10, 0x03, 0x21, 0x03, 0x19, 0xe3, 0x18, 0x04, 0x21, 0xc3, 0x18, 0x03, 0x21, 0x0b, 0x63, 0x38, 0xc6, 0xe3, 0x18, 0x91, 0x8c, 0xf3, 0x9c, 0xa2, 0x10, 0xc2, 0x10, 0xc2, 0x10, 0xe3, 0x18, 0xe3, 0x18, 0x24, 0x21, 0x03, 0x19, 0x03, 0x19, 0x55, 0xad, 0x71, 0x8c, 0x24, 0x21, 0xba, 0xd6, 0x69, 0x4a, 0x82, 0x10, 0xc3, 0x18,
  0xa1, 0x08, 0x81, 0x08, 0x48, 0x42, 0xb9, 0xce, 0x03, 0x19, 0x28, 0x42, 0x4c, 0x63, 0x4c, 0x63, 0x4c, 0x63, 0x2c, 0x63, 0x0b, 0x63, 0x24, 0x21, 0x89, 0x4a, 0x58, 0xc6, 0x24, 0x21, 0x71, 0x8c, 0x38, 0xc6, 0x2c, 0x63, 0x6d, 0x6b, 0x6d, 0x6b, 0x2c, 0x63, 0x89, 0x4a, 0xa2, 0x10, 0x69, 0x4a, 0x4c, 0x63, 0x18, 0xc6, 0x51, 0x8c, 0x24, 0x21, 0x9a, 0xd6, 0x69, 0x4a, 0x61, 0x10, 0x82, 0x10,
  0xc2, 0x08, 0xa2, 0x08, 0x68, 0x42, 0x79, 0xc6, 0xe2, 0x10, 0x50, 0x84, 0x1b, 0xe7, 0xf7, 0xbd, 0x17, 0xbe, 0x17, 0xbe, 0x5c, 0xe7, 0x85, 0x31, 0x28, 0x42, 0xb2, 0x94, 0xa2, 0x10, 0x8d, 0x6b, 0xf7, 0xbd, 0x17, 0xc6, 0xf7, 0xbd, 0xb6, 0xb5, 0x99, 0xd6, 0x75, 0xad, 0xc2, 0x10, 0x51, 0x8c, 0x17, 0xbe, 0xb6, 0xb5, 0x4d, 0x6b, 0x44, 0x29, 0x99, 0xd6, 0x69, 0x52, 0x82, 0x10, 0x82, 0x10,
  0xc2, 0x08, 0x81, 0x08, 0x48, 0x42, 0xda, 0xd6, 0x03, 0x19, 0x50, 0x84, 0x54, 0xa5, 0xc2, 0x10, 0xa2, 0x10, 0x85, 0x29, 0x3c, 0xe7, 0x65, 0x29, 0xe3, 0x18, 0xc2, 0x10, 0xc2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0x61, 0x08, 0xe3, 0x18, 0xae, 0x73, 0x95, 0xb5, 0xa2, 0x10, 0xc2, 0x18, 0xa2, 0x10, 0xc2, 0x10, 0xa2, 0x10, 0x03, 0x21, 0x9a, 0xd6, 0x69, 0x4a, 0x61, 0x08, 0x82, 0x10,
  0xc2, 0x10, 0xa1, 0x08, 0x48, 0x42, 0x99, 0xce, 0xe3, 0x18, 0x50, 0x84, 0x34, 0xa5, 0x81, 0x10, 0x0f, 0x7c, 0x75, 0xad, 0x7d, 0xef, 0xd6, 0xbd, 0x13, 0xa5, 0xf3, 0x9c, 0x34, 0xa5, 0x34, 0xa5, 0x54, 0xad, 0x14, 0xa5, 0xd3, 0x9c, 0xa2, 0x10, 0x6d, 0x6b, 0xfb, 0xde, 0x75, 0xad, 0x13, 0xa5, 0x34, 0xa5, 0x34, 0xa5, 0xeb, 0x5a, 0x04, 0x21, 0x9a, 0xd6, 0x69, 0x52, 0x82, 0x10, 0xa2, 0x10,
  0x81, 0x08, 0xc2, 0x10, 0x68, 0x42, 0x99, 0xce, 0x03, 0x19, 0x50, 0x84, 0xf3, 0x9c, 0xc2, 0x10, 0x6d, 0x6b, 0x71, 0x8c, 0x71, 0x8c, 0x91, 0x8c, 0x71, 0x8c, 0x91, 0x8c, 0x71, 0x8c, 0x71, 0x8c, 0x71, 0x8c, 0xf3, 0x9c, 0xdb, 0xde, 0x04, 0x21, 0x6d, 0x6b, 0xba, 0xd6, 0x71, 0x8c, 0x51, 0x8c, 0x71, 0x8c, 0x79, 0xce, 0x30, 0x84, 0x24, 0x21, 0xba, 0xde, 0x49, 0x4a, 0x61, 0x10, 0x82, 0x10,
  0xa2, 0x10, 0x81, 0x08, 0x28, 0x42, 0xda, 0xd6, 0xe3, 0x18, 0x50, 0x8c, 0x54, 0xa5, 0xe3, 0x18, 0xc2, 0x18, 0xc2, 0x18, 0xa2, 0x10, 0xa2, 0x10, 0xc2, 0x10, 0xc2, 0x18, 0xc2, 0x18, 0xa2, 0x10, 0xa2, 0x10, 0xa6, 0x31, 0xfb, 0xde, 0x04, 0x21, 0x6d, 0x6b, 0xb6, 0xb5, 0xc2, 0x10, 0xe3, 0x18, 0xa2, 0x10, 0xf3, 0x9c, 0x50, 0x8c, 0xe3, 0x18, 0x9a, 0xd6, 0x69, 0x4a, 0xa2, 0x10, 0x81, 0x10,
  0x81, 0x08, 0xc2, 0x10, 0x69, 0x4a, 0xba, 0xd6, 0x03, 0x21, 0x10, 0x84, 0xfb, 0xde, 0x18, 0xc6, 0x38, 0xc6, 0x17, 0xc6, 0xb6, 0xb5, 0x65, 0x29, 0x07, 0x42, 0x38, 0xc6, 0x58, 0xce, 0x79, 0xce, 0x51, 0x8c, 0x86, 0x31, 0xfb, 0xde, 0x24, 0x21, 0x4c, 0x63, 0x7d, 0xef, 0x18, 0xc6, 0xb2, 0x94, 0xa2, 0x10, 0x91, 0x94, 0x0f, 0x84, 0x44, 0x29, 0x99, 0xd6, 0x69, 0x4a, 0x81, 0x10, 0xa2, 0x10,
  0x81, 0x08, 0xc2, 0x10, 0x28, 0x42, 0x99, 0xce, 0xc2, 0x18, 0xc6, 0x39, 0xeb, 0x5a, 0xcb, 0x5a, 0xaa, 0x52, 0xca, 0x5a, 0xaa, 0x52, 0xc2, 0x18, 0xcb, 0x5a, 0xfb, 0xde, 0x2c, 0x63, 0xeb, 0x5a, 0x07, 0x3a, 0xe3, 0x18, 0xca, 0x52, 0xe3, 0x18, 0x65, 0x29, 0xeb, 0x5a, 0xcb, 0x52, 0x48, 0x42, 0x81, 0x08, 0x28, 0x42, 0xa6, 0x31, 0xe3, 0x18, 0xba, 0xd6, 0x69, 0x4a, 0x41, 0x08, 0xa2, 0x18,
  0xa2, 0x10, 0xa2, 0x10, 0x28, 0x42, 0xba, 0xd6, 0x85, 0x29, 0x24, 0x21, 0x03, 0x19, 0x44, 0x21, 0x24, 0x21, 0x44, 0x29, 0x03, 0x21, 0x03, 0x19, 0x0b, 0x63, 0x99, 0xce, 0x85, 0x31, 0x03, 0x21, 0x03, 0x19, 0x24, 0x21, 0x24, 0x21, 0x03, 0x19, 0x24, 0x21, 0x03, 0x19, 0x24, 0x21, 0x45, 0x29, 0x03, 0x19, 0x03, 0x21, 0x03, 0x21, 0x85, 0x31, 0xba, 0xd6, 0x89, 0x52, 0xa2, 0x10, 0x82, 0x10,
  0x61, 0x08, 0x61, 0x08, 0x89, 0x4a, 0xde, 0xf7, 0x99, 0xce, 0xfb, 0xde, 0x99, 0xce, 0xba, 0xd6, 0x79, 0xce, 0xba, 0xd6, 0xba, 0xd6, 0xfb, 0xde, 0x1b, 0xdf, 0x9d, 0xef, 0xda, 0xd6, 0xda, 0xd6, 0xfb, 0xd6, 0x99, 0xce, 0xdb, 0xd6, 0xda, 0xd6, 0xda, 0xd6, 0xba, 0xd6, 0xda, 0xd6, 0x79, 0xce, 0xdb, 0xde, 0x99, 0xce, 0xda, 0xde, 0xda, 0xde, 0xbe, 0xf7, 0x69, 0x4a, 0x61, 0x08, 0x82, 0x10,
  0xc2, 0x10, 0x81, 0x08, 0xe3, 0x18, 0x89, 0x4a, 0x89, 0x4a, 0xa9, 0x4a, 0x89, 0x4a, 0xaa, 0x4a, 0xca, 0x52, 0x69, 0x4a, 0xca, 0x52, 0x89, 0x4a, 0xaa, 0x4a, 0xa9, 0x4a, 0xa9, 0x4a, 0x89, 0x4a, 0x8a, 0x4a, 0xaa, 0x4a, 0x89, 0x4a, 0xca, 0x52, 0xaa, 0x4a, 0x89, 0x4a, 0x8a, 0x4a, 0xcb, 0x52, 0x8a, 0x4a, 0xaa, 0x52, 0x89, 0x4a, 0x69, 0x4a, 0x89, 0x52, 0x24, 0x21, 0xa2, 0x10, 0x61, 0x10,
  0x81, 0x08, 0xa2, 0x08, 0xc2, 0x10, 0x61, 0x00, 0xa1, 0x08, 0xa1, 0x08, 0xa1, 0x08, 0x81, 0x08, 0xa1, 0x08, 0xa1, 0x08, 0x81, 0x08, 0xa1, 0x08, 0xc2, 0x10, 0x61, 0x00, 0xa1, 0x08, 0xc2, 0x10, 0xa2, 0x08, 0x81, 0x08, 0xc2, 0x10, 0x61, 0x00, 0x81, 0x08, 0xa2, 0x08, 0x82, 0x08, 0x81, 0x08, 0x81, 0x08, 0x81, 0x10, 0x81, 0x10, 0xc2, 0x18, 0x81, 0x10, 0x61, 0x08, 0x81, 0x10, 0x82, 0x10,
  0xc2, 0x10, 0x81, 0x00, 0xa1, 0x08, 0xa2, 0x08, 0xa2, 0x08, 0xa1, 0x08, 0xa1, 0x08, 0xa1, 0x08, 0xa2, 0x08, 0x81, 0x08, 0xc2, 0x10, 0xa1, 0x08, 0x81, 0x08, 0xa2, 0x08, 0xa1, 0x08, 0x61, 0x00, 0xa2, 0x08, 0xc2, 0x08, 0x81, 0x08, 0xc2, 0x08, 0xc2, 0x10, 0x81, 0x08, 0xa2, 0x10, 0xa2, 0x08, 0xa2, 0x10, 0x81, 0x08, 0x81, 0x10, 0x81, 0x10, 0xa2, 0x10, 0x81, 0x10, 0xa2, 0x18, 0x81, 0x10,
};
const uint32_t laberinto_bueno_len = 2048;


#define FREC 50 //Frecuencia en hercios del tren de pulsos: 20ms
volatile int Flag_ints=0;
unsigned long REG_TT[6];
const int32_t REG_CAL[6]= {CAL_DEFAULTS};


uint32_t LeeRam32(uint32_t addr)
{
    uint32_t valor;

    HAL_SPI_CSLow();
    FT800_SPI_SendAddressRD(addr);
    valor = FT800_SPI_Read32();
    HAL_SPI_CSHigh();

    return valor;
}

void EscribeRam8_G(uint8_t dato)
{
    HAL_SPI_CSLow();
    FT800_SPI_SendAddressWR(RAM_G + CMD_Offset_G);  // Writing to next available location in FIFO (FIFO base address + offset)
    FT800_SPI_Write8(dato);                  // Vertex 2F    01XXXXXX XXXXXXXX XYYYYYYY YYYYYYYY
    HAL_SPI_CSHigh();

    CMD_Offset_G = FT800_IncCMDOffset(CMD_Offset_G, 1); // Move the CMD Offset since we have just added 4 bytes to the FIFO
}

void Ft_Gpu_Hal_WrRAMG(const uint8_t *buffer, uint32_t length)
{
    uint32_t i;

    // Escribir cada byte del buffer en el FIFO de comandos
    for (i = 0; i < length; i++)
    {
        EscribeRam8_G(buffer[i]);
    }
}

void ComJPEG(const uint8_t *jpg, const uint32_t longitud)
{

    ComEsperaFin();

    /*EscribeRam32(CMD_LOADIMAGE);
    EscribeRam32(destino);
    EscribeRam32(0);*/
    Ft_Gpu_Hal_WrRAMG(jpg, longitud);


    /*EscribeRam32(BITMAP_SOURCE(0));
    EscribeRam32(BITMAP_LAYOUT(RGB565, 32 * 2, 32));
    EscribeRam32(BITMAP_SIZE(0, 0, 0, 32, 32));*/
}

void ComBITMAP(){

    EscribeRam32(CMD_BEGIN_BMP);
    EscribeRam32(BITMAP_SOURCE(0));
    EscribeRam32(BITMAP_LAYOUT(RGB565, 32 * 2, 32));
    EscribeRam32(BITMAP_SIZE(0, 0, 0, 32, 32));
    ComVertex2ff(50,50);
    EscribeRam32(CMD_END);
}


void SysCtlSleepFake(void)
{
    while(!Flag_ints);
    Flag_ints=0;
}

//Enum de estados
typedef enum {
    pedirPin = 0,
    acceso=1,
    pedirHora=2,
    paginaPrincipal=3,
    laberinto=4,

} Estados;

int estado=pedirPin;


//Enum de estados
typedef enum {
    reposo = 0,
    pulso=1,
    depulso=2,

} EstadosLectura;
int estadoLecturaNumerosPantalla=reposo;

int aux[5];
int cont=0;
char auxc[4][2];
int pin[] = {1,2,3,4};
int numeroLeidoPantalla[50];
int i,k=0,j=0,t_espera=0;
int hora=0,minuto=0,segundo=0,milisegundo=0;
int auxLectura=0;
int parpadeo,parpadeo2;






int botoneraPin(){
    int aux[11];
    aux[0]=0;
    aux[1]=0;
    aux[2]=0;
    aux[3]=0;
    aux[4]=0;
    aux[5]=0;
    aux[6]=0;
    aux[7]=0;
    aux[8]=0;
    aux[9]=0;
    aux[10]=0;

    ComColor(255,255,255);
    ComFgcolor(0, 0, 180);

    aux[1]=Boton(HSIZE/2-150,100,50,50,30,"1");
    aux[2]=Boton(HSIZE/2-85,100,50,50,30,"2");
    aux[3]=Boton(HSIZE/2-25,100,50,50,30,"3");
    aux[4]=Boton(HSIZE/2+35,100,50,50,30,"4");
    aux[5]=Boton(HSIZE/2+100,100,50,50,30,"5");

    aux[6]=Boton(HSIZE/2-150,160,50,50,30,"6");
    aux[7]=Boton(HSIZE/2-85,160,50,50,30,"7");
    aux[8]=Boton(HSIZE/2-25,160,50,50,30,"8");
    aux[9]=Boton(HSIZE/2+35,160,50,50,30,"9");
    aux[0]=Boton(HSIZE/2+100,160,50,50,30,"0");

    ComFgcolor(0, 0, 180);
    aux[10]=Boton(HSIZE/2-50,4*VSIZE/5,100,45,30,"OK");






    if(aux[0]==1)return 0;
    else if(aux[1]==1)return 1;
    else if(aux[2]==1)return 2;
    else if(aux[3]==1)return 3;
    else if(aux[4]==1)return 4;
    else if(aux[5]==1)return 5;
    else if(aux[6]==1)return 6;
    else if(aux[7]==1)return 7;
    else if(aux[8]==1)return 8;
    else if(aux[9]==1)return 9;
    else if(aux[10]==1)return 10;   //Intro
    else return 11; //No se pulsa nada
}
void IntTimer(void)
{
    TimerIntClear(TIMER0_BASE, TIMER_TIMA_TIMEOUT);
    SysCtlDelay(20); //Retraso necesario. Mirar Driverlib p.550
    Flag_ints++;
}

int verificarPinInicial(){
        switch(cont){
        case 0:
            aux[0]=botoneraPin();
            if(aux[0]>=0 && aux[0]<=9){
                sprintf(auxc[cont],"%d",aux[0]);
                cont=6;
            }
            return 0;
            //break;
        case 1:
            aux[1]=botoneraPin();
            ComTXT(HSIZE/2,75,25, OPT_CENTER,auxc[0]);
            if(aux[1]>=0 && aux[1]<=9){
                sprintf(auxc[cont],"%d",aux[1]);
                cont=7;
            }
            return 0;
            //break;
        case 2:
            aux[2]=botoneraPin();
            ComTXT(HSIZE/2-10,75,25, OPT_CENTER,auxc[0]);
            ComTXT(HSIZE/2+10,75,25, OPT_CENTER,auxc[1]);
            if(aux[2]>=0 && aux[2]<=9){
                sprintf(auxc[cont],"%d",aux[2]);
                cont=8;
            }
            return 0;
            //break;
        case 3:
            aux[3]=botoneraPin();
            ComTXT(HSIZE/2-20,75,25, OPT_CENTER,auxc[0]);
            ComTXT(HSIZE/2,75,25, OPT_CENTER,auxc[1]);
            ComTXT(HSIZE/2+20,75,25, OPT_CENTER,auxc[2]);
            if(aux[3]>=0 && aux[3]<=9){
                sprintf(auxc[cont],"%d",aux[3]);
                cont=9;
            }
            return 0;
            //break;
        case 4:
            aux[4]=botoneraPin();
            ComTXT(HSIZE/2-30,75,25, OPT_CENTER,auxc[0]);
            ComTXT(HSIZE/2-10,75,25, OPT_CENTER,auxc[1]);
            ComTXT(HSIZE/2+10,75,25, OPT_CENTER,auxc[2]);
            ComTXT(HSIZE/2+30,75,25, OPT_CENTER,auxc[3]);
            if(aux[4]==10){
                cont=10;
            }
            return 0;
            //break;
        case 5:
            botoneraPin();
            if(aux[0]==pin[0] && aux[1]==pin[1] && aux[2]==pin[2] && aux[3]==pin[3]){
                cont=0;
                aux[0]=0;
                aux[1]=0;
                aux[2]=0;
                aux[3]=0;
                return 1;
            }
            else{
                cont=0;
                aux[0]=0;
                aux[1]=0;
                aux[2]=0;
                aux[3]=0;
                return 0;
            }

        case 6:
            if(botoneraPin()==11)cont=1;
            break;
        case 7:
            if(botoneraPin()==11)cont=2;
            ComTXT(HSIZE/2,75,25, OPT_CENTER,auxc[0]);
            break;
        case 8:
            if(botoneraPin()==11)cont=3;
            ComTXT(HSIZE/2-10,75,25, OPT_CENTER,auxc[0]);
            ComTXT(HSIZE/2+10,75,25, OPT_CENTER,auxc[1]);
            break;
        case 9:
            if(botoneraPin()==11)cont=4;
            ComTXT(HSIZE/2-20,75,25, OPT_CENTER,auxc[0]);
            ComTXT(HSIZE/2,75,25, OPT_CENTER,auxc[1]);
            ComTXT(HSIZE/2+20,75,25, OPT_CENTER,auxc[2]);
            break;
        case 10:
            if(botoneraPin()==11)cont=5;
            ComTXT(HSIZE/2-30,75,25, OPT_CENTER,auxc[0]);
            ComTXT(HSIZE/2-10,75,25, OPT_CENTER,auxc[1]);
            ComTXT(HSIZE/2+10,75,25, OPT_CENTER,auxc[2]);
            ComTXT(HSIZE/2+30,75,25, OPT_CENTER,auxc[3]);
            break;
        }
        return 0;
}


int lecturaNumerosPantalla(){

    char auxcc[2];

    if(numeroLeidoPantalla[i]==11) numeroLeidoPantalla[i]=0;

    hora=numeroLeidoPantalla[0]*10 + numeroLeidoPantalla[1];
    minuto=numeroLeidoPantalla[2]*10 + numeroLeidoPantalla[3];
    segundo=numeroLeidoPantalla[4]*10 + numeroLeidoPantalla[5];

    if(i<2){
        ComColor(255*parpadeo,255*parpadeo,255*parpadeo);
        ComRect(HSIZE/2-90,30,HSIZE/2-35,60,1);
        ComColor(255*parpadeo2,255*parpadeo2,255*parpadeo2);
        sprintf(auxcc,"%02d:",hora);
        ComTXT(HSIZE/2-60,45,31, OPT_CENTER,auxcc);

        ComColor(255,255,255);
        sprintf(auxcc,"%02d:",minuto);
        ComTXT(HSIZE/2+3,45,31, OPT_CENTER,auxcc);
        sprintf(auxcc,"%02d",segundo);
        ComTXT(HSIZE/2+60,45,31, OPT_CENTER,auxcc);
    }
    else if(i<4){
        ComColor(255*parpadeo,255*parpadeo,255*parpadeo);
        ComRect(HSIZE/2-25,30,HSIZE/2+28,60,1);
        ComColor(255*parpadeo2,255*parpadeo2,255*parpadeo2);
        sprintf(auxcc,"%02d:",minuto);
        ComTXT(HSIZE/2+3,45,31, OPT_CENTER,auxcc);

        ComColor(255,255,255);
        sprintf(auxcc,"%02d:",hora);
        ComTXT(HSIZE/2-60,45,31, OPT_CENTER,auxcc);
        sprintf(auxcc,"%02d",segundo);
        ComTXT(HSIZE/2+60,45,31, OPT_CENTER,auxcc);
    }
    else if(i<6){
        ComColor(255*parpadeo,255*parpadeo,255*parpadeo);
        ComRect(HSIZE/2+38,30,HSIZE/2+85,60,1);
        ComColor(255*parpadeo2,255*parpadeo2,255*parpadeo2);
        sprintf(auxcc,"%02d",segundo);
        ComTXT(HSIZE/2+60,45,31, OPT_CENTER,auxcc);

        ComColor(255,255,255);
        sprintf(auxcc,"%02d:",hora);
        ComTXT(HSIZE/2-60,45,31, OPT_CENTER,auxcc);
        sprintf(auxcc,"%02d:",minuto);
        ComTXT(HSIZE/2+3,45,31, OPT_CENTER,auxcc);
    }
    else{
        ComColor(255,255,255);
        sprintf(auxcc,"%02d",segundo);
        ComTXT(HSIZE/2+60,45,31, OPT_CENTER,auxcc);
        sprintf(auxcc,"%02d:",hora);
        ComTXT(HSIZE/2-60,45,31, OPT_CENTER,auxcc);
        sprintf(auxcc,"%02d:",minuto);
        ComTXT(HSIZE/2+3,45,31, OPT_CENTER,auxcc);

    }


    switch (estadoLecturaNumerosPantalla){
        case reposo:
            numeroLeidoPantalla[i]=botoneraPin();
            if(numeroLeidoPantalla[i]>=0 && numeroLeidoPantalla[i]<=9){
                sprintf(auxc[i],"%d",numeroLeidoPantalla[i]);
                estadoLecturaNumerosPantalla=pulso;
            }
            else if(numeroLeidoPantalla[i]==10){
                estadoLecturaNumerosPantalla=pulso;
            }
            break;
        case pulso:
            if(numeroLeidoPantalla[i]==botoneraPin())estadoLecturaNumerosPantalla=pulso;
            else estadoLecturaNumerosPantalla=depulso;
            break;
        case depulso:
            if(numeroLeidoPantalla[i]==10){
                estadoLecturaNumerosPantalla=reposo;
                i=0;
                return 1;   //Si devuelve un 1 es que se ha pulsado intro y se ha terminado de escribir
            }
            else{
                estadoLecturaNumerosPantalla=reposo;
                i++;
                return 0;
            }

    }
    return 0;
}


void dibujaHora(){
    char auxcc[2];
    sprintf(auxcc,"%02d:",hora);
    ComTXT(40+320,20,28, 0,auxcc);
    sprintf(auxcc,"%02d:",minuto);
    ComTXT(70+320,20,28, 0,auxcc);
    sprintf(auxcc,"%02d",segundo);
    ComTXT(100+320,20,28, 0,auxcc);
}

void updateHora(){
    milisegundo=milisegundo+20;
    if(milisegundo>=1000){
        milisegundo=0;
        segundo++;
        if(parpadeo==0){
            parpadeo2=0;
            parpadeo++;}
        else{
            parpadeo2++;
            parpadeo=0;}
    }
    if(segundo>=60){
        segundo=0;
        minuto++;
    }
    if(minuto>=60){
        minuto=0;
        hora++;
    }
    if(hora>=24)hora=0;

}









int main(void)
{
    //
    // Run from the PLL at 120 MHz.
    //
    RELOJ = SysCtlClockFreqSet((SYSCTL_XTAL_25MHZ |
            SYSCTL_OSC_MAIN | SYSCTL_USE_PLL |
            SYSCTL_CFG_VCO_480), 120000000);


    //
    // Initialize the UART.
    //
    SysCtlPeripheralEnable(SYSCTL_PERIPH_GPIOA);
    SysCtlPeripheralEnable(SYSCTL_PERIPH_UART0);
    GPIOPinConfigure(GPIO_PA0_U0RX);
    GPIOPinConfigure(GPIO_PA1_U0TX);
    GPIOPinTypeUART(GPIO_PORTA_BASE, GPIO_PIN_0 | GPIO_PIN_1);
    UARTStdioConfig(0, 115200, RELOJ);


    //-----------Timer 0--------------//
    SysCtlPeripheralEnable(SYSCTL_PERIPH_TIMER0);       //Habilita T0
    TimerClockSourceSet(TIMER0_BASE, TIMER_CLOCK_SYSTEM);   //T0 a 120MHz
    TimerConfigure(TIMER0_BASE, TIMER_CFG_PERIODIC);    //T0 periodico y conjunto (32b)
    TimerLoadSet(TIMER0_BASE, TIMER_A, (RELOJ/FREC)-1);
    TimerIntRegister(TIMER0_BASE,TIMER_A,IntTimer);
    IntEnable(INT_TIMER0A); //Habilitar las interrupciones globales de los timers
    TimerIntEnable(TIMER0_BASE, TIMER_TIMA_TIMEOUT);    // Habilitar las interrupciones de timeout
    IntMasterEnable();  //Habilitacion global de interrupciones
    TimerEnable(TIMER0_BASE, TIMER_A);  //Habilitar Timer0, 1, 2A y 2B


    SysCtlPeripheralClockGating(true);

    HAL_Init_SPI(1, RELOJ);  //Boosterpack a usar, Velocidad del MC
    Inicia_pantalla();       //Arranque de la pantalla
    SysCtlDelay(RELOJ/3);

    ComJPEG(laberinto_bueno,laberinto_bueno_len);


    // ================================================================================================================
    // PANTALLA INICIAL
    // ================================================================================================================
        Nueva_pantalla(180,180,220);
        //El numerito indica el numero dela fuente que estamos usando, ver libreria pag 140
        ComColor(255,255,255);
        ComTXT(HSIZE/2,VSIZE/2-45,30, OPT_CENTERX,"TOCA LA PANTALLA");
        ComTXT(HSIZE/2,VSIZE/2,30, OPT_CENTERX,"PARA EMPEZAR");
        Dibuja();
        Espera_pant();

        for(i=0;i<6;i++)    Esc_Reg(REG_TOUCH_TRANSFORM_A+4*i, REG_CAL[i]);
        i=0;
    while(1){
        SLEEP;
        Lee_pantalla();
        Nueva_pantalla(180,180,220);

        if(estado==pedirPin)
            ComBITMAP();

        else{
        ComFgcolor(0, 255, 0);
        ComColor(255,255,255);


        updateHora();

        switch (estado){
            case pedirPin:
                ComColor(255,255,255);
                ComTXT(HSIZE/2,40,30, OPT_CENTER,"Introduzca su pin:");
                ComColor(0,0,0);
                ComRect(HSIZE/2-50,62,HSIZE/2+50,87,1);
                ComColor(0,0,180);
                ComRect(HSIZE/2-48,64,HSIZE/2+48,85,1);
                if(verificarPinInicial())estado=acceso;
                else estado=pedirPin;
                segundo=0;
                break;
            case acceso:
                ComTXT(HSIZE/2,VSIZE/2-45,30, OPT_CENTERX,"ESPERA 5 SEGUNDOS");
                ComTXT(HSIZE/2,VSIZE/2,30, OPT_CENTERX,"E INTRODUCE HORA FORMATO:");
                ComTXT(HSIZE/2,VSIZE/2+45,30, OPT_CENTERX,"HHMMSS");
                if(segundo==5)estado=pedirHora;
                break;
            case pedirHora:
                auxLectura=lecturaNumerosPantalla();
                if(auxLectura && numeroLeidoPantalla[6]==10){
                    estado=paginaPrincipal;
                    hora=numeroLeidoPantalla[0]*10 + numeroLeidoPantalla[1];
                    minuto=numeroLeidoPantalla[2]*10 + numeroLeidoPantalla[3];
                    segundo=numeroLeidoPantalla[4]*10 + numeroLeidoPantalla[5];
                }
                else if(auxLectura==1){
                    estado=acceso;
                    segundo=0;
                }
                break;
            case paginaPrincipal:
                dibujaHora();
                ComTXT(HSIZE/2,VSIZE/2-45,30, OPT_CENTERX,"BIENVENIDO");
                ComTXT(HSIZE/2,VSIZE/2,30, OPT_CENTERX,"A LA PAGINA");
                ComTXT(HSIZE/2,VSIZE/2+45,30, OPT_CENTERX,"PRINCPIAL");
                if (Boton(HSIZE/2-30,30,60,60,30,"Laberinto")){
                    t_espera=0;
                    estado=laberinto;
                }
                break;

           case laberinto:

                break;
        }


        }
        Dibuja();

    }

}





